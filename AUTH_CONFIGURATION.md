# è®¤è¯é…ç½®è¯´æ˜

## ğŸ” æ–°çš„è®¤è¯å‚æ•°æ ¼å¼

æ ¹æ®æ‚¨çš„è¦æ±‚ï¼Œåº”ç”¨å·²æ›´æ–°ä¸ºæ”¯æŒçµæ´»çš„è¯·æ±‚å¤´è®¤è¯æ–¹å¼ï¼ŒWebSocketè¿æ¥URLæ ¼å¼å¦‚ä¸‹ï¼š

```
ws://47.239.194.151:3002/?deviceId=ID&authKey=key&authValue=value
```

## ğŸ“‹ é…ç½®å­—æ®µè¯´æ˜

### å¿…å¡«å­—æ®µ
- **æœåŠ¡å™¨åœ°å€**: WebSocketæœåŠ¡å™¨çš„IPåœ°å€æˆ–åŸŸå
- **WebSocketç«¯å£**: æœåŠ¡å™¨WebSocketæœåŠ¡ç«¯å£ï¼ˆé»˜è®¤3002ï¼‰

### å¯é€‰å­—æ®µ
- **è®¾å¤‡ID**: è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰
- **è¯·æ±‚å¤´åç§° (Header Key)**: è®¤è¯è¯·æ±‚å¤´çš„åç§°
- **è¯·æ±‚å¤´å€¼ (Header Value)**: è®¤è¯è¯·æ±‚å¤´çš„å€¼

## ğŸ”§ é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºæœ¬è¿æ¥ï¼ˆæ— è®¤è¯ï¼‰
```
æœåŠ¡å™¨åœ°å€: 47.239.194.151
WebSocketç«¯å£: 3002
è®¾å¤‡ID: (ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ)
è¯·æ±‚å¤´åç§°: (ç•™ç©º)
è¯·æ±‚å¤´å€¼: (ç•™ç©º)
```
**ç”Ÿæˆçš„URL**: `ws://47.239.194.151:3002/?deviceId=auto-generated-id`

### ç¤ºä¾‹2: Bearer Tokenè®¤è¯
```
æœåŠ¡å™¨åœ°å€: 47.239.194.151
WebSocketç«¯å£: 3002
è®¾å¤‡ID: my-device-001
è¯·æ±‚å¤´åç§°: Authorization
è¯·æ±‚å¤´å€¼: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```
**ç”Ÿæˆçš„URL**: `ws://47.239.194.151:3002/?deviceId=my-device-001&authKey=Authorization&authValue=Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

### ç¤ºä¾‹3: API Keyè®¤è¯
```
æœåŠ¡å™¨åœ°å€: 47.239.194.151
WebSocketç«¯å£: 3002
è®¾å¤‡ID: mobile-client
è¯·æ±‚å¤´åç§°: X-API-Key
è¯·æ±‚å¤´å€¼: sk-1234567890abcdef
```
**ç”Ÿæˆçš„URL**: `ws://47.239.194.151:3002/?deviceId=mobile-client&authKey=X-API-Key&authValue=sk-1234567890abcdef`

### ç¤ºä¾‹4: è‡ªå®šä¹‰Tokenè®¤è¯
```
æœåŠ¡å™¨åœ°å€: 47.239.194.151
WebSocketç«¯å£: 3002
è®¾å¤‡ID: android-app
è¯·æ±‚å¤´åç§°: X-Auth-Token
è¯·æ±‚å¤´å€¼: custom-token-12345
```
**ç”Ÿæˆçš„URL**: `ws://47.239.194.151:3002/?deviceId=android-app&authKey=X-Auth-Token&authValue=custom-token-12345`

## ğŸ¯ å¸¸ç”¨è®¤è¯å¤´åç§°

| è®¤è¯ç±»å‹ | Header Key | Header Value ç¤ºä¾‹ |
|----------|------------|-------------------|
| Bearer Token | `Authorization` | `Bearer your-jwt-token` |
| API Key | `X-API-Key` | `your-api-key` |
| Custom Token | `X-Auth-Token` | `your-custom-token` |
| Basic Auth | `Authorization` | `Basic base64(username:password)` |
| Session Token | `X-Session-Token` | `session-id-12345` |
| Access Token | `X-Access-Token` | `access-token-67890` |

## ğŸ”„ URLç”Ÿæˆé€»è¾‘

åº”ç”¨ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨ç”ŸæˆWebSocketè¿æ¥URLï¼š

```kotlin
val websocketUrlWithAuth: String
    get() {
        val baseUrl = websocketUrl  // ws://host:port/
        val params = mutableListOf<String>()
        
        // æ·»åŠ è®¾å¤‡ID
        if (deviceId.isNotEmpty()) {
            params.add("deviceId=$deviceId")
        }
        
        // æ·»åŠ è®¤è¯å‚æ•°
        if (authKey.isNotEmpty() && authValue.isNotEmpty()) {
            params.add("authKey=$authKey")
            params.add("authValue=$authValue")
        }
        
        return if (params.isNotEmpty()) {
            "$baseUrl?${params.joinToString("&")}"
        } else {
            baseUrl
        }
    }
```

## ğŸ“± åº”ç”¨ç•Œé¢é…ç½®

### é…ç½®ç•Œé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨é…ç½®                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡å™¨åœ°å€ *                        â”‚
â”‚ [47.239.194.151              ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WebSocketç«¯å£ *                     â”‚
â”‚ [3002                        ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¾å¤‡IDï¼ˆå¯é€‰ï¼‰                      â”‚
â”‚ [ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ                ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¤è¯é…ç½®                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯·æ±‚å¤´åç§° (Header Key)             â”‚
â”‚ [ä¾‹å¦‚: Authorization         ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯·æ±‚å¤´å€¼ (Header Value)             â”‚
â”‚ [ä¾‹å¦‚: Bearer your-token     ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ä¿å­˜é…ç½®] [æµ‹è¯•è¿æ¥]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å­—æ®µéªŒè¯è§„åˆ™
- **æœåŠ¡å™¨åœ°å€**: å¿…å¡«ï¼Œä¸èƒ½ä¸ºç©º
- **WebSocketç«¯å£**: å¿…å¡«ï¼Œ1-65535ä¹‹é—´çš„æ•°å­—
- **è®¾å¤‡ID**: å¯é€‰ï¼Œç•™ç©ºè‡ªåŠ¨ç”ŸæˆUUID
- **è¯·æ±‚å¤´åç§°**: å¯é€‰ï¼Œå¦‚æœå¡«å†™åˆ™è¯·æ±‚å¤´å€¼ä¹Ÿå¿…é¡»å¡«å†™
- **è¯·æ±‚å¤´å€¼**: å¯é€‰ï¼Œå¦‚æœå¡«å†™åˆ™è¯·æ±‚å¤´åç§°ä¹Ÿå¿…é¡»å¡«å†™

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- è®¤è¯ä¿¡æ¯æœ¬åœ°åŠ å¯†å­˜å‚¨
- é¿å…åœ¨æ—¥å¿—ä¸­è¾“å‡ºå®Œæ•´çš„è®¤è¯å€¼
- æ”¯æŒå®‰å…¨è¿æ¥ï¼ˆWSSåè®®ï¼‰

### 2. è®¤è¯æœ€ä½³å®è·µ
- ä½¿ç”¨å¼ºå¯†ç æˆ–å¤æ‚Token
- å®šæœŸæ›´æ¢è®¤è¯å‡­æ®
- é¿å…åœ¨ä¸å®‰å…¨ç½‘ç»œä¸­ä¼ è¾“è®¤è¯ä¿¡æ¯
- è€ƒè™‘ä½¿ç”¨JWTç­‰æœ‰æ—¶æ•ˆæ€§çš„Token

### 3. æœåŠ¡å™¨ç«¯é…ç½®
æœåŠ¡å™¨éœ€è¦è§£æURLå‚æ•°ä¸­çš„è®¤è¯ä¿¡æ¯ï¼š
```javascript
// Node.js ç¤ºä¾‹
const url = require('url');
const querystring = require('querystring');

wss.on('connection', (ws, req) => {
    const query = querystring.parse(url.parse(req.url).query);
    const deviceId = query.deviceId;
    const authKey = query.authKey;
    const authValue = query.authValue;
    
    // éªŒè¯è®¤è¯ä¿¡æ¯
    if (authKey && authValue) {
        // æ ¹æ®authKeyç±»å‹éªŒè¯authValue
        if (!validateAuth(authKey, authValue)) {
            ws.close(1008, 'Authentication failed');
            return;
        }
    }
    
    // è¿æ¥æˆåŠŸï¼Œå¤„ç†åç»­é€»è¾‘
});
```

## ğŸš€ ä½¿ç”¨æµç¨‹

### 1. åŸºæœ¬é…ç½®
1. æ‰“å¼€åº”ç”¨ï¼Œç‚¹å‡»å³ä¸Šè§’è®¾ç½®æŒ‰é’®
2. å¡«å†™æœåŠ¡å™¨åœ°å€å’ŒWebSocketç«¯å£
3. ç‚¹å‡»"ä¿å­˜é…ç½®"

### 2. æ·»åŠ è®¤è¯ï¼ˆå¯é€‰ï¼‰
1. åœ¨"è®¤è¯é…ç½®"éƒ¨åˆ†å¡«å†™è¯·æ±‚å¤´åç§°
2. å¡«å†™å¯¹åº”çš„è¯·æ±‚å¤´å€¼
3. ç‚¹å‡»"ä¿å­˜é…ç½®"

### 3. æµ‹è¯•è¿æ¥
1. ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
2. æŸ¥çœ‹è¿æ¥çŠ¶æ€æç¤º
3. å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®

### 4. å¼€å§‹ä½¿ç”¨
1. é…ç½®æˆåŠŸåè¿”å›ä¸»ç•Œé¢
2. åº”ç”¨ä¼šè‡ªåŠ¨è¿æ¥åˆ°WebSocketæœåŠ¡å™¨
3. å¼€å§‹äº«å—å®æ—¶å‰ªåˆ‡æ¿åŒæ­¥åŠŸèƒ½

## ğŸ“Š è¿æ¥çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|
| å·²è¿æ¥ | ğŸŸ¢ | WebSocketè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥åŒæ­¥ |
| æœªè¿æ¥ | ğŸ”´ | WebSocketè¿æ¥æ–­å¼€ |
| é‡è¿ä¸­ | ğŸŸ¡ | æ­£åœ¨å°è¯•é‡æ–°è¿æ¥ |
| è®¤è¯å¤±è´¥ | âŒ | è®¤è¯ä¿¡æ¯é”™è¯¯ï¼Œè¯·æ£€æŸ¥é…ç½® |

## ğŸ”§ æ•…éšœæ’é™¤

### è¿æ¥å¤±è´¥
1. æ£€æŸ¥æœåŠ¡å™¨åœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æœåŠ¡å™¨WebSocketæœåŠ¡æ­£åœ¨è¿è¡Œ
3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. éªŒè¯è®¤è¯ä¿¡æ¯æ˜¯å¦æ­£ç¡®

### è®¤è¯å¤±è´¥
1. ç¡®è®¤è¯·æ±‚å¤´åç§°æ ¼å¼æ­£ç¡®
2. æ£€æŸ¥è¯·æ±‚å¤´å€¼æ˜¯å¦æœ‰æ•ˆ
3. è”ç³»æœåŠ¡å™¨ç®¡ç†å‘˜ç¡®è®¤è®¤è¯æ–¹å¼
4. å°è¯•é‡æ–°è·å–è®¤è¯å‡­æ®

è¿™ä¸ªæ–°çš„è®¤è¯é…ç½®æ–¹å¼æä¾›äº†æœ€å¤§çš„çµæ´»æ€§ï¼Œæ”¯æŒå„ç§å¸¸è§çš„è®¤è¯æ–¹æ¡ˆï¼ğŸ”
