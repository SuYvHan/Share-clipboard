# 权限检查功能说明

## 功能概述

在应用**首次启动**时，系统会自动检查以下权限：

1. **基础权限**：存储权限、通知权限等
2. **电池优化**：检查应用是否被电池优化限制
3. **自启动权限**：检查应用是否有自启动权限（主要针对国产手机）

## 显示策略

### 首次启动检查
- **权限检查对话框**：仅在应用首次安装后启动时显示
- **剪切板限制说明**：仅在Android 12+设备首次启动时显示
- 后续启动不会再自动弹出这些对话框

### 手动检查
- 用户可以在**设置页面**中手动触发权限检查
- 设置 → 权限管理 → 重新检查权限

## 新增文件

### 1. AdvancedPermissionDialog.kt
- 位置：`app/src/main/java/com/clipboardsync/app/ui/components/AdvancedPermissionDialog.kt`
- 功能：显示权限检查结果的对话框
- 特性：
  - 显示基础权限状态
  - 显示电池优化状态
  - 显示自启动权限状态
  - 显示设备信息
  - 提供权限设置快捷入口

### 2. 扩展的PermissionUtils.kt
- 新增功能：
  - 电池优化检查和设置
  - 自启动权限检查（支持小米、华为、OPPO、VIVO、魅族、三星）
  - 综合权限检查结果

## 权限检查逻辑

### 电池优化检查
- **Android 6.0+**：检查应用是否在电池优化白名单中
- **Android 6.0以下**：自动通过（无电池优化功能）

### 自启动权限检查
根据设备品牌检查对应的自启动设置：

- **小米**：MIUI安全中心 → 自启动管理
- **华为/荣耀**：手机管家 → 启动管理
- **OPPO**：手机管家 → 权限隐私 → 自启动管理
- **VIVO**：i管家 → 应用管理 → 自启动
- **魅族**：手机管家 → 权限管理
- **三星**：通常不需要特殊设置

## 用户体验

### 启动时检查
1. 应用启动时自动检查所有权限
2. 如果发现权限问题，显示权限检查对话框
3. 用户可以选择立即设置或稍后处理

### 权限设置引导
- **基础权限**：跳转到系统权限设置页面
- **电池优化**：直接跳转到电池优化设置页面
- **自启动权限**：跳转到对应品牌的自启动设置页面

## 技术特点

### 兼容性
- 支持Android 6.0+的电池优化检查
- 支持主流国产手机的自启动权限检查
- 自动适配不同Android版本的权限策略

### 用户友好
- 清晰的权限状态显示
- 一键跳转到对应设置页面
- 详细的权限说明和建议

### 稳定性
- 异常处理：如果无法检测某项权限，会优雅降级
- 日志记录：详细的权限检查日志便于调试
- 向后兼容：保持原有权限检查逻辑不变

## 使用建议

### 对于用户
1. **首次使用**：按照对话框提示完成所有权限设置
2. **电池优化**：建议关闭以确保后台服务正常运行
3. **自启动权限**：建议开启以确保开机后自动运行

### 对于开发者
1. 权限检查在`onCreate()`中自动执行
2. 可以通过`PermissionUtils.checkAllPermissions()`手动检查
3. 权限状态变化会自动更新UI显示

## 注意事项

1. **自启动权限检测**：由于各厂商实现不同，只能检测是否支持设置，无法准确获取当前状态
2. **电池优化**：部分设备可能需要用户手动在设置中操作
3. **权限引导**：某些设备的权限设置页面可能与预期不同，这是正常现象

## 测试建议

1. 在不同品牌的设备上测试权限检查功能
2. 验证权限设置跳转是否正常工作
3. 确认权限状态检查的准确性
